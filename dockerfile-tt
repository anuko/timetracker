# This file is for development work. Not suitable for production.
FROM php:7.2-apache

# Use the default production configuration.
RUN mv "$PHP_INI_DIR/php.ini-production" "$PHP_INI_DIR/php.ini"

# Override with custom settings.
# COPY config/php_tt.ini $PHP_INI_DIR/conf.d/

# Install php extensions.
RUN apt-get update && apt-get install --no-install-recommends -y \
  libpng-dev \
  libfreetype6-dev \
  libldap2-dev && \
  rm -rf /var/lib/apt/lists/*
  
# Configure php extensions
RUN docker-php-ext-configure gd --with-freetype-dir=/usr/include/ \
 && docker-php-ext-install gd \
  ldap \
  mysqli
 
# Copy application source code to /var/www/html/.
COPY . /var/www/html/

# Create configuration file.
RUN cp /var/www/html/WEB-INF/config.php.dist /var/www/html/WEB-INF/config.php

# Replace DSN value to something connectable to a Docker container running mariadb.
RUN sed -i "s|mysqli://root:no@localhost/dbname|mysqli://anuko_user:anuko_pw@anuko_db/timetracker|g" /var/www/html/WEB-INF/config.php
# Note that db is defined as anuko_db/timetracker where anuko_db is service name and timetracker is db name.
# See docker-compose.yml for details.

RUN chown -R www-data /var/www/html/
